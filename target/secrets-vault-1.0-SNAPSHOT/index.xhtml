<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Password Manager</title>
    <h:outputStylesheet name="css/index_style.css"/>
</h:head>
<h:body>
    <!-- Navbar -->
    <div class="navbar">
        <div>
            <a href="#" class="password-list">Password List</a>
        </div>
        <div>
            <a href="login.xhtml" class="logout">Logout</a>
        </div>
    </div>
    <!-- DataTable Container -->
    <h:form id="passwordForm">
        <!-- Add Password Button -->
        <div class="add-password-button-container">
            <p:button value="Add Password" outcome="addPassword.xhtml" styleClass="add-password-button" icon="pi pi-plus"/>
        </div>
        <!-- Search and Filter Controls -->
        <div class="table-container">
            <p:dataTable id="dataTable" var="password" value="#{passwordBean.passwords}" styleClass="custom-datatable" widgetVar="passwordTableVar"
                         rows="10" paginator="true" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} 
                         {PageLinks} {NextpageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}--{endRecord} of {totalRecords} records"
                         rowsPerPageTemplate="5,10,{ShowAll|'All'}">
                <p:column headerText="Title" filterBy="#{password.title}" filterMatchMode="contains">
                    <h:outputText value="#{password.title}" />
                </p:column>
                <p:column headerText="URL" filterBy="#{password.url}" filterMatchMode="contains">
                    <h:outputText value="#{password.url}"/>
                </p:column>
                <p:column headerText="Username" filterBy="#{password.username}" filterMatchMode="contains">
                    <h:outputText value="#{password.username}"/>
                </p:column>
                <p:column headerText="Password">
                    <h:outputText value="********" rendered="#{!password.showPassword}" />
                    <h:outputText value="#{password.decryptedPassword}" rendered="#{password.showPassword}" />
                    <p:commandLink actionListener="#{passwordBean.toggleShowPassword(password)}"
                                   update="dataTable" title="Şifreyi Göster/Gizle">
                        <i class="#{password.showPassword ? 'pi pi-eye' : 'pi pi-eye-slash'}" />
                    </p:commandLink>
                </p:column>
                <p:column headerText="Notes" filterBy="#{password.notes}" filterMatchMode="contains">
                    <h:outputText value="#{password.notes}"/>
                </p:column>
                <p:column headerText="Actions">
                    <p:commandButton value="Edit" icon="pi pi-pencil" styleClass="btn-edit"
                                     actionListener="#{passwordMB.prepareUpdate(password)}"
                                     update=":editDialogForm" oncomplete="PF('editDialog').show();" />
                    <p:commandButton value="Delete" icon="pi pi-trash" styleClass="btn-delete"
                                     actionListener="#{passwordMB.deletePassword(password)}"
                                     update="dataTable" />
                </p:column>
            </p:dataTable>
        </div>
    </h:form>
    <!-- Edit Dialog -->
    <p:dialog header="Edit Password" widgetVar="editDialog" modal="true" resizable="false">
        <h:form id="editDialogForm">
            <p:panelGrid columns="2">
                <p:outputLabel for="title" value="Title:" />
                <p:inputText id="title" value="#{passwordBean.selectedPassword.title}" required="true" />
                <p:outputLabel for="url" value="URL:" />
                <p:inputText id="url" value="#{passwordBean.selectedPassword.url}" />
                <p:outputLabel for="username" value="Username:" />
                <p:inputText id="username" value="#{passwordBean.selectedPassword.username}" required="true" />
                <p:outputLabel for="password" value="Password:" />
                <p:password id="password" value="#{passwordBean.selectedPassword.password}" required="true" feedback="true" match="confirmPassword" />
                <p:outputLabel for="notes" value="Notes:" />
                <p:inputTextarea id="notes" value="#{passwordBean.selectedPassword.notes}" />
            </p:panelGrid>
            <p:commandButton value="Save" actionListener="#{passwordMB.updatePassword}" update=":passwordForm:dataTable" oncomplete="PF('editDialog').hide();" />
        </h:form>
    </p:dialog>



        <script>
            function editPassword(id) {
                console.log("Edit function called with ID: ", id);
                window.location.href = "editPassword.xhtml?id=" + id;
            }

            function deletePassword(id) {
                if (confirm("Bu şifreyi silmek istediğinize emin misiniz?")) {
                    console.log("Delete function called with ID: ", id);
                    var element = document.getElementById("passwordRow-" + id);
                    if (element) {
                        element.parentNode.parentNode.removeChild(element.parentNode);
                    } else {
                        alert("Şifre bulunamadı! ID: " + id);
                    }
                }
            }
            function scrollToBottom() {
                window.scrollTo(0, document.body.scrollHeight);
            }
            function showPassword(element) {
                var hiddenPassword = element.parentElement.querySelector('.hidden-password');
                var showPassword = element.parentElement.querySelector('.show-password');

                if (hiddenPassword.style.display === "none") {
                    hiddenPassword.style.display = "inline";
                    showPassword.textContent = "*********";
                } else {
                    hiddenPassword.style.display = "none";
                    showPassword.textContent = "*********";
                }
            }

            type = "text/javascript" >
                    // Şifreyi göster/gizle fonksiyonu
                            function togglePasswordVisibility(entryId) {
                                var passwordElement = document.getElementById('password_' + entryId);
                                var isPasswordVisible = passwordElement.classList.contains('visible-password');

                                // Şifre şu anda gösteriliyorsa, gizle
                                if (isPasswordVisible) {
                                    passwordElement.classList.remove('visible-password');
                                    passwordElement.textContent = '********'; // Gizlenmiş şifreyi tekrar göster
                                } else {
                                    // Şifreyi göster
                                    passwordElement.classList.add('visible-password');
                                    passwordElement.textContent = passwordElement.dataset.password; // Gerçek şifreyi göster
                                }
                            }




        </script>
    </h:body>
</html>
