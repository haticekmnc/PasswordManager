<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>User Records</title>
        <h:outputScript library="js" name="scripts.js" />
        <h:outputStylesheet name="css/user_records_style.css" />
        <h:outputStylesheet name="css/login_style.css"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-***************************" crossorigin="anonymous" />
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
        <h:outputScript name="js/togglePassword.js" target="head"/> 
        <h:outputStylesheet name="css/password_list_style.css"/>
        <h:outputScript library="primefaces" name="primefaces.js"/>
        <h:outputScript library="primefaces" name="core.js"/>
    </h:head>
    <h:body>
        <div class="content-container">
            <div class="add-record-button-container">

                <p:commandButton value="Add Record" oncomplete="PF('addRecordDialog').show();" rendered="#{loginMB.isAdmin}" icon="pi pi-plus" styleClass="add-password-button" />
            </div>
            <div class="table-container">
                <h:form id="userForm" class="form-container">
                    <p:dataTable id="dataTable" var="user" value="#{userBean.users}" styleClass="custom-datatable" rows="10" paginator="true" paginatorPosition="bottom"
                                 currentPageReportTemplate="{startRecord}--{endRecord} of {totalRecords} records"
                                 rowsPerPageTemplate="5,10,15,10000" emptyMessage="No records found!!!">
                        <p:column headerText="Username" filterBy="#{user.username}" filterMatchMode="contains">
                            <h:outputText value="#{user.username}" />
                        </p:column>
                        
                        <p:column headerText="Password">
                            <h:outputText value="********" styleClass="password-hidden" rendered="#{!user.showPassword}"/>
                            <h:outputText value="#{user.password}" styleClass="password-visible" rendered="#{user.showPassword}" />
                            <p:commandLink title="Toggle Show/Hide Password" actionListener="#{userBean.toggleShowPassword(user, true)}" 
                                           update="dataTable" onclick="handlePasswordVisibility(this, #{user.showPassword})" >
                                <i class="#{user.showPassword ? 'pi pi-eye ' : 'pi pi-eye-slash'}" />
                            </p:commandLink>
                        </p:column>
                        
                        <p:column headerText="Email" filterBy="#{user.email}" filterMatchMode="contains">
                            <h:outputText value="#{user.email}" />
                        </p:column>
                        <p:column headerText="Admin">
                            <h:outputText value="#{user.isAdmin ? 'Yes' : 'No'}" />
                        </p:column>
                    </p:dataTable>
                </h:form>
            </div>
        </div>

        <p:dialog header="Add Record" widgetVar="addRecordDialog" modal="true" resizable="false" appendTo="@(body)" styleClass="add-password-form">
            <h:form id="registerForm" class="add-password-form">
                <h2>Add New Record</h2>
                <div class="form-field">
                    <h:inputText id="username" value="#{registerMB.username}" required="true" requiredMessage="Username is required!">
                        <f:passThroughAttribute name="placeholder" value="Username"/>
                    </h:inputText>
                </div>
                <div class="form-field">
                    <h:inputText id="email" value="#{registerMB.email}" required="true" requiredMessage="Email is required!">
                        <f:passThroughAttribute name="placeholder" value="Email"/>
                    </h:inputText>
                </div>
                <div class="form-field">
                    <div class="password-container">
                        <h:inputSecret id="password" value="#{registerMB.password}" required="true" requiredMessage="Password is required!" styleClass="password-input">
                            <f:passThroughAttribute name="placeholder" value="Password" />
                        </h:inputSecret>
                        <span class="password-toggle">
                            <i id="eye-icon" class="fas fa-eye-slash" style="color: purple; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;" onclick="togglePasswordVisibilityRegister()"></i>
                        </span>
                    </div>
                </div>
                <div class="form-field">
                    <div class="password-container">
                        <h:inputSecret id="confirmPassword" value="#{registerMB.confirmPassword}" required="true" requiredMessage="Please confirm your password!" styleClass="password-input">
                            <f:passThroughAttribute name="placeholder" value="Confirm Password" />
                        </h:inputSecret>
                        <span class="password-toggle">
                            <i id="eye-icon" class="fas fa-eye-slash" style="color: purple; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;" onclick="togglePasswordVisibilityRegister()"></i>
                        </span>
                    </div>
                </div>
                <!-- Hata mesajlarını göstermek için -->
                <!-- <p:growl id="messages" life="3000"/> --> 

                <div class="form-field">

                    <p:commandButton value="Add Record" action="#{registerMB.register}" ajax="true" styleClass="login-button" update=":userForm:dataTable" oncomplete="PF('addRecordDialog').hide();" />
                </div>

            </h:form>
            <div class="form-field" style="position: absolute; top: 20px; left: 20px;">
                <h:button value="&#8592;" style="font-size: 20px;" outcome="index.xhtml" styleClass="back-button"/>
            </div>
        </p:dialog>
        
        
        <script type="text/javascript">
    function handlePasswordVisibility(linkElement, isPasswordVisible) {
        if (!isPasswordVisible) {
            setTimeout(function() {
                // Şifrenin hala gösterildiğinden emin ol
                if (linkElement.querySelector('i').classList.contains('pi-eye')) {
                    linkElement.click();
                }
            }, 3000); // 3000 milisaniye (3 saniye) sonra şifreyi gizle
        }
    }
</script>

        

    </h:body>
</html>
